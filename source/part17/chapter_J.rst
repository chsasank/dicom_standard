.. _chapter_J:

Handling of Identifying Parameters (Informative)
================================================

This Annex was formerly located in in the 2003 and earlier revisions of
the Standard.

.. _sect_J.1:

Purpose of This Annex
---------------------

The DICOM Standard was published in 1993 and addresses medical images
communication between medical modalities, workstations and other medical
devices as well as data exchange between medical devices and the
Information System (IS). DICOM defines SOP Instances with Patient, Visit
and Study information managed by the Information System and allows to
communicate the Attribute values of these objects.

Since the publication of the DICOM Standard great effort has been made
to harmonize the Information Model of the DICOM Standard with the models
of other relevant standards, especially with the HL7 model and the CEN
TC 251 WG3 PT 022 model. The result of these effort is a better
understanding of the various practical situations in hospitals and an
adaptation of the model to these situations. In the discussion of
models, the definition of Information Entities and their Identifying
Parameters play a very important role.

The purpose of this Informative Annex is to show which identifying
parameters may be included in Image SOP Instances and their related
Modality Performed Procedure Step (MPPS) SOP Instance. Different
scenarios are elucidated to describe varying levels of integration of
the Modality with the Information System, as well as situations in which
a connection is temporarily unavailable.

.. note::

   In this Annex, "Image SOP Instance" is used as a collective term for
   all Composite Image Storage SOP Instances.

The scenarios described here are informative and do not constitute a
normative section of the DICOM Standard.

.. _sect_J.2:

Integrated Environment
----------------------

"Integrated" means in this context that the Acquisition Modality is
connected to an Information System or Systems that may be an SCP of the
Modality Worklist SOP Class or an SCP of the Modality Performed
Procedure Step SOP Class or both. In the following description only the
behavior of "Modalities" is mentioned, it goes without saying that the
IS must conform to the same SOP Classes.

The Modality receives identifying parameters by querying the Modality
Worklist SCP and generates other Attribute values during image
generation. It is desirable that these identifying parameters be
included in the Image SOP Instances as well as in the MPPS object in a
consistent manner. In the case of a Modality that is integrated but
unable to receive or send identifying parameters, e.g., link down,
emergency case, the Modality may behave as if it were not integrated.

The Study Instance UID is a crucial Attribute that is used to relate
Image SOP Instances (whose Study is identified by their Study Instance
UID), the Modality PPS SOP Instance that contains it as a reference, and
the actual or conceptual Requested Procedure (i.e., Study) and related
Imaging Service Request in the IS. An IS that manages an actual or
conceptual Detached Study Management entity is expected to be able to
relate this Study Instance UID to the SOP Instance UID of the Detached
Study Management SOP Instance, whether or not the Study Instance UID is
provided by the IS or generated by the modality.

For a detailed description of an integrated environment see the IHE
Radiology Technical Framework. This document can be obtained at
http://www.ihe.net/

.. _sect_J.2.1:

Modality Conforms to Modality Worklist and MPPS SOP Classes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The modality may:

-  N-CREATE a MPPS SOP Instance and include its SOP Instance UID in the
   Image SOP Instances within the Referenced Performed Procedure Step
   Sequence Attribute.

-  Copy the following Attribute values from the Modality Worklist
   information into the Image SOP Instances and into the related MPPS
   SOP Instance:

   -  Study Instance UID

   -  Referenced Study Sequence

   -  Accession Number

   -  Requested Procedure ID

   -  Scheduled Procedure Step ID

   -  Scheduled Procedure Step Description

   -  Scheduled Protocol Code Sequence

-  Create the following Attribute value and include it into the Image
   SOP Instances and the related MPPS SOP Instance:

   -  Performed Procedure Step ID

-  Include the following Attribute values that may be generated during
   image acquisition, if supported, into the Image SOP Instances and the
   related MPPS SOP Instance:

   -  Performed Procedure Step Start Date

   -  Performed Procedure Step Start Time

   -  Performed Procedure Step Description

   -  Study ID

.. _sect_J.2.2:

Modality Conforms Only to The Modality Worklist SOP Class
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The modality may:

-  In the absence of the ability to N-CREATE a MPPS SOP Instance,
   generate a MPPS SOP Instance UID and include it into the Referenced
   Performed Procedure Step Sequence Attribute of the Image SOP
   Instances. A system that later N-CREATEs a MPPS SOP Instance may use
   this UID extracted from the related Image SOP Instances.

-  Copy the following Attribute values from the Modality Worklist
   information into the Image SOP Instances:

   -  Study Instance UID

   -  Referenced Study Sequence

   -  Accession Number

   -  Requested Procedure ID

   -  Scheduled Procedure Step ID

   -  Scheduled Procedure Step Description

   -  Scheduled Protocol Code Sequence

-  Create the following Attribute value and include it into the Image
   SOP Instances:

   -  Performed Procedure Step ID

A system that later N-CREATEs a MPPS SOP Instance may use this Attribute
value extracted from the related Image SOP Instances.

-  Include the following Attribute values that may be generated during
   image acquisition, if supported, into the Image SOP Instances:

   -  Performed Procedure Step Start Date

   -  Performed Procedure Step Start Time

   -  Performed Procedure Step Description

   -  Study ID

A system that later N-CREATEs a MPPS SOP Instance may use these
Attribute values extracted from the related Image SOP Instances.

.. _sect_J.2.3:

Modality Conforms Only to The MPPS SOP Class
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The modality may:

-  N-CREATE a MPPS SOP Instance and include its SOP Instance UID in the
   Image SOP Instances within the Referenced Performed Procedure Step
   Sequence Attribute.

-  Create the following Attribute values and include them in the Image
   SOP Instances and the related MPPS SOP Instance:

   -  Study Instance UID

   -  Performed Procedure Step ID

-  Copy the following Attribute values, if available to the Modality,
   into the Image SOP Instances and into the related MPPS SOP Instance:

   -  Accession Number

   -  Patient ID

   -  Patient's Name

   -  Patient's Birth Date

   -  Patient's Sex

If sufficient identifying information is included, it will allow the
Image SOP Instances and the MPPS SOP Instance to be later related to the
Requested Procedure and the actual or conceptual Detached Study
Management entity.

-  Include the following Attribute values that may be generated during
   image acquisition, if supported, into the Image SOP Instances and the
   related MPPS SOP Instance:

   -  Performed Procedure Step Start Date

   -  Performed Procedure Step Start Time

   -  Performed Procedure Step Description

   -  Study ID

.. _sect_J.3:

Non-integrated Environment
--------------------------

"Non-Integrated" means in this context that the Acquisition Modality is
not connected to an Information System Systems, does not receive
Attribute values from an SCP of the Modality Worklist SOP Class, and
cannot create a Performed Procedure Step SOP Instance.

The modality may:

-  In the absence of the ability to N-CREATE a MPPS SOP Instance,
   generate a MPPS SOP Instance UID and include it into the Referenced
   Performed Procedure Step Sequence Attribute of the Image SOP
   Instances. A system that later N-CREATEs a MPPS SOP Instance may use
   this UID extracted from the related Image SOP Instances.

-  Create the following Attribute values and include them in the Image
   SOP Instances:

   -  Study Instance UID

   -  Performed Procedure Step ID

A system that later N-CREATEs a MPPS SOP Instance may use these
Attribute values extracted from the related Image SOP Instances.

-  Copy the following Attribute values, if available to the Modality,
   into the Image SOP Instances:

   -  Accession Number

   -  Patient ID

   -  Patient's Name

   -  Patient's Birth Date

   -  Patient's Sex

If sufficient identifying information is be included, it will allow the
Image SOP Instances to be later related to the Requested Procedure and
the actual or conceptual Detached Study Management entity.

-  Include the following Attribute values that may be generated during
   image acquisition, if supported, into the Image SOP Instances:

   -  Performed Procedure Step Start Date

   -  Performed Procedure Step Start Time

   -  Performed Procedure Step Description

   -  Study ID

A system that later N-CREATEs a MPPS SOP Instance may use these
Attribute values extracted from the related Image SOP Instances.

.. _sect_J.4:

One MPPS Is Created in Response to Two Or More Requested Procedures
-------------------------------------------------------------------

In the MPPS SOP Instance, all the specific Attributes of a Scheduled
Procedure Step or Steps are included in the Scheduled Step Attributes
Sequence. In the Image SOP Instances, these Attributes may be included
in the Request Attributes Sequence. This is an optional Sequence in
order not to change the definition of existing SOP Classes by adding new
required Attributes or changing the meaning of existing Attributes.

Both Sequences may have more than one Item if more than one Requested
Procedure results in a single Performed Procedure Step.

Because of the definitions of existing Attributes in existing Image SOP
Classes, the following solutions are a compromise. The first one chooses
or creates a value for the single valued Attributes Study Instance UID
and Accession Number. The second one completely replicates the Image
data with different values for the Attributes Study Instance UID and
Accession Number.

.. _sect_J.4.1:

Choose Or Create A Value For Study Instance UID and Accession Number
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The modality may:

-  In the Image SOP Instances:

   -  create a Request Attributes Sequence containing two or more Items
      each containing the following Attributes:

      -  Requested Procedure ID

      -  Scheduled Procedure Step ID

      -  Scheduled Procedure Step Description

      -  Scheduled Protocol Code Sequence

   -  create a Referenced Study Sequence containing two or more Items
      sufficient to contain the Study SOP Instance UID values from the
      Modality Worklist for both Requested Procedures

   -  select one value from the Modality Worklist or generate a new
      value for:

      -  Study Instance UID

   -  select one value from the Modality Worklist or generate a new
      value or assign an empty value for:

      -  Accession Number

-  In the MPPS SOP Instance:

   -  create a Scheduled Step Attributes Sequence containing two or more
      Items each containing the following Attributes:

      -  Study Instance UID

      -  Referenced Study Sequence

      -  Accession Number

      -  Requested Procedure ID

      -  Scheduled Procedure Step ID

      -  Scheduled Procedure Step Description

      -  Scheduled Protocol Code Sequence

   -  include the following Attribute value that may be generated during
      image acquisition, if supported:

      -  Procedure Code Sequence

-  In both the Image SOP Instances and the MPPS SOP Instance

   -  create a Performed Procedure Step ID

   -  include the following Attribute values that may be generated
      during image acquisition, if supported:

      -  Performed Procedure Step Start Date

      -  Performed Procedure Step Start Time

      -  Performed Procedure Step Description

      -  Study ID

.. _sect_J.4.2:

Replicate The Image IOD
~~~~~~~~~~~~~~~~~~~~~~~

An alternative method is to replicate the entire Image SOP Instance with
a new SOP Instance UID, and assign each Image IOD it's own identifying
Attributes. In this case, each of the Study Instance UID and the
Accession Number values can be used in their own Image SOP Instance.

Both Image SOP Instances may reference a single MPPS SOP Instance (via
the MPPS SOP Instance UID in the Referenced Performed Procedure Step
Sequence).

Each individual Image SOP Instance may reference it's own related Study
SOP Instance, if it exists (via the Referenced Study Sequence). This
Study SOP Instance has a one to one relationship with the corresponding
Requested Procedure.

If an MPPS SOP Instance is created, it may reference both related Study
SOP Instances.

The modality may:

-  For all Series in the MPPS, replicate the entire Series of Images
   using new Series Instance UIDs

-  Create replicated Image SOP Instances with different SOP Instance
   UIDs that use the new Series Instance UIDs, for each of the two or
   more Requested Procedures

-  In each of the Image SOP Instances, using values from the
   corresponding Requested Procedure:

   -  create a Request Attributes Sequence containing an Item containing
      the following Attributes:

      -  Requested Procedure ID

      -  Scheduled Procedure Step ID

      -  Scheduled Procedure Step Description

      -  Scheduled Protocol Code Sequence

   -  copy from the Modality Worklist:

      -  Study Instance UID

      -  Accession Number

   -  create a Referenced Study Sequence containing an Item containing
      the following Attribute:

      -  Study SOP Instance in the Referenced Study Sequence from the
         Worklist

-  In the MPPS SOP Instance (if supported):

   -  create a Scheduled Step Attributes Sequence containing two or more
      Items each containing the following Attributes:

      -  Study Instance UID

      -  Referenced Study Sequence

      -  Accession Number

      -  Requested Procedure ID

      -  Scheduled Procedure Step ID

      -  Scheduled Procedure Step Description

      -  Scheduled Protocol Code Sequence

   -  include the following Attribute value that may be generated during
      image acquisition, if supported:

      -  Procedure Code Sequence

-  In both the Image SOP Instances and the MPPS SOP Instance (if
   supported):

   -  create a Performed Procedure Step ID

      -  include the following Attribute values that may be generated
         during image acquisition, if supported:

         -  Performed Procedure Step Start Date

         -  Performed Procedure Step Start Time

         -  Performed Procedure Step Description

         -  Study ID

.. _sect_J.5:

MPPS SOP Instance Created by Another System (not the Modality)
--------------------------------------------------------------

If for some reason the Modality was unable to create the MPPS SOP
Instance, another system may wish to perform this service. This system
must make sure that the created PPS SOP Instance is consistent with the
related Image SOP Instances.

Depending on the availability and correctness of values for the
Attributes in the Image SOP Instances, these values may be copied into
the MPPS SOP Instance, or they may have to be coerced, e.g., if they are
not consistent with corresponding values available from the IS.

For example, if the MPPS SOP Instance UID is already available in the
Image SOP Instance (in the Referenced Performed Procedure Step
Sequence), it may be utilized to N-CREATE the MPPS SOP Instance. If not
available, a new MPPS SOP Instance UID may be generated and used to
N-CREATE the MPPS SOP Instance. In this case there may be no MPPS SOP
Instance UID in the Referenced Performed Procedure Step Sequence in the
corresponding Image SOP Instances. An update of the Image SOP Instances
will restore the consistency, but this is not required.

.. _sect_J.6:

Mapping of Study Instance UIDs to the Study SOP Instance UID
------------------------------------------------------------

Retired. See PS3.17-2004.

